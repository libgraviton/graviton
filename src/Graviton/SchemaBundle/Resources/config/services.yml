parameters:
  graviton.schema.service.schemautils.class: Graviton\SchemaBundle\SchemaUtils
  graviton.schema.constraint.utils.class: Graviton\SchemaBundle\Constraint\ConstraintUtils
  graviton.schema.constraint.incrementaldate.class: Graviton\SchemaBundle\Constraint\IncrementalDateFieldConstraint
  graviton.schema.constraint.readonlyfield.class: Graviton\SchemaBundle\Constraint\ReadOnlyFieldConstraint
  graviton.schema.constraint.versionservice.class: Graviton\SchemaBundle\Constraint\VersionServiceConstraint
  graviton.schema.constraint.recordorigin.class: Graviton\SchemaBundle\Constraint\RecordOriginConstraint
  graviton.schema.serializer.handler.additionalproperties.class: Graviton\SchemaBundle\Serializer\Handler\SchemaAdditionalPropertiesHandler
  graviton.schema.serializer.handler.type.class: Graviton\SchemaBundle\Serializer\Handler\SchemaTypeHandler
  graviton.schema.serializer.handler.enum.class: Graviton\SchemaBundle\Serializer\Handler\SchemaEnumHandler

services:

    graviton.schema.serializer.handler.additionalproperties:
        class: "%graviton.schema.serializer.handler.additionalproperties.class%"
        tags:
          -
            name: jms_serializer.handler
            type: Graviton\SchemaBundle\Document\SchemaAdditionalProperties
            format: json

    graviton.schema.serializer.handler.type:
        class: "%graviton.schema.serializer.handler.type.class%"
        tags:
          -
            name: jms_serializer.handler
            type: Graviton\SchemaBundle\Document\SchemaType
            format: json

    graviton.schema.serializer.handler.enum:
        class: "%graviton.schema.serializer.handler.enum.class%"
        tags:
          -
            name: jms_serializer.handler
            type: Graviton\SchemaBundle\Document\SchemaEnum
            format: json

    graviton.schema.constraint.utils:
        class: "%graviton.schema.constraint.utils.class%"
        arguments:
          - "@doctrine_mongodb.odm.default_document_manager"
          - '@Graviton\RestBundle\Service\RestUtils'
          - "@request_stack"
        tags:
          -
            name: kernel.event_listener
            event: graviton.json_schema.constraint.schema
            method: onSchemaValidation
            priority: 999

    graviton.schema.constraint.incrementaldate:
        class: "%graviton.schema.constraint.incrementaldate.class%"
        arguments:
          - "@graviton.schema.constraint.utils"
        tags:
          -
            name: kernel.event_listener
            event: graviton.json_schema.constraint.format
            method: checkIncrementalDate

    graviton.schema.constraint.readonlyfield:
        class: "%graviton.schema.constraint.readonlyfield.class%"
        arguments:
          - "@graviton.schema.constraint.utils"
          - "%graviton.document.readonly.fields%"
        tags:
          -
            name: kernel.event_listener
            event: graviton.json_schema.constraint.schema
            method: checkReadOnlyFields

    graviton.schema.constraint.versionservice:
        class: "%graviton.schema.constraint.versionservice.class%"
        arguments:
          - "@graviton.schema.constraint.utils"
        tags:
          -
            name: kernel.event_listener
            event: graviton.json_schema.constraint.schema
            method: checkVersionField
          -
            name: kernel.event_listener
            event: kernel.response
            method: setCurrentVersionHeader

    graviton.schema.constraint.recordorigin:
        class: "%graviton.schema.constraint.recordorigin.class%"
        arguments:
          - "@graviton.schema.constraint.utils"
          - recordOrigin
          - "%graviton.rest.not_modifiable.origin.records%"
          - "%graviton.document.recordoriginexception.fields%"
        tags:
          -
            name: kernel.event_listener
            event: graviton.json_schema.constraint.schema
            method: checkRecordOrigin

