
services:

    graviton.core.jms.cache.provider:
        class: Metadata\Cache\PsrCacheAdapter
        arguments:
          - "jms"
          - "@graviton.cache.adapter.app"

    # we must alias this as external bundles refer to this service that way
    graviton.core.http.client:
      parent: graviton.common.http.client

    Graviton\CoreBundle\Controller\MainController:
      #public: true
      tags: ['controller.service_arguments']
      arguments:
        - "@router"
        - '@Graviton\RestBundle\Service\RestUtils'
        - "@event_dispatcher"

    # Request host listener -->
    Graviton\CoreBundle\Listener\RequestHostListener:
        arguments:
          - "@router"
          - "%graviton.router.host%"
          - "%graviton.router.port_http%"
          - "%graviton.router.port_https%"
        tags:
          -
            name: "kernel.event_listener"
            event: "kernel.request"
            method: "onKernelRequest"

    Graviton\CoreBundle\Controller\VersionController:
      tags: ['controller.service_arguments']
      calls:
        -
          method: "setVersionInformation"
          arguments:
            - "%graviton.core.version.data%"

    graviton.core.service.jmespath:
        class: JmesPath\CompilerRuntime
        public: true
        arguments:
          - "%graviton.jmespath.cache_dir%"

    Graviton\CoreBundle\Listener\JsonExceptionListener:
        calls:
          -
            method: "setLogger"
            arguments:
              - "@logger"
        tags:
          -
            name: "kernel.event_listener"
            event: "kernel.exception"
            method: "onKernelException"

    graviton.core.repository.dummy:
      class: Doctrine\ODM\MongoDB\Repository\DocumentRepository
      factory: ['@doctrine_mongodb.odm.default_document_manager', 'getRepository']
      arguments:
        - 'GravitonCoreBundle:Dummy'

    graviton.core.model.dummy:
      class: Graviton\CoreBundle\Model\Dummy
      parent: "graviton.rest.model"
      arguments:
        - "%kernel.project_dir%/src/Graviton/CoreBundle/Resources/config/schema/Dummy.json"
        - Graviton\CoreBundle\Document\Dummy
        - '@doctrine_mongodb.odm.default_document_manager'

    graviton.core.document.dummy:
      class: Graviton\CoreBundle\Document\Dummy

    # fixtures
    Graviton\CoreBundle\DataFixtures\MongoDB\LoadAppData:
      public: true
      tags:
          - { name: 'doctrine.fixture.orm' }

    Graviton\CoreBundle\DataFixtures\MongoDB\LoadAppDataExceedSinglePageLimit:
      public: true
      tags:
        - { name: 'doctrine.fixture.orm' }

    Graviton\CoreBundle\DataFixtures\MongoDB\LoadAppDataNoShowMenu:
      public: true
      tags:
        - { name: 'doctrine.fixture.orm' }
