<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>
        <parameter key="graviton_generator.definition.loader.class">Graviton\GeneratorBundle\Definition\Loader\Loader</parameter>
        <parameter key="graviton_generator.definition.loader.strategy.file.class">Graviton\GeneratorBundle\Definition\Loader\Strategy\FileStrategy</parameter>
        <parameter key="graviton_generator.definition.loader.strategy.dir.class">Graviton\GeneratorBundle\Definition\Loader\Strategy\DirStrategy</parameter>
        <parameter key="graviton_generator.definition.loader.strategy.scan.class">Graviton\GeneratorBundle\Definition\Loader\Strategy\ScanStrategy</parameter>
    </parameters>

    <services>
        <service id="graviton_generator.definition.loader" class="%graviton_generator.definition.loader.class%">
            <call method="addStrategy">
                <argument type="service" id="graviton_generator.definition.loader.strategy.file"/>
            </call>
            <call method="addStrategy">
                <argument type="service" id="graviton_generator.definition.loader.strategy.dir"/>
            </call>
            <call method="addStrategy">
                <argument type="service" id="graviton_generator.definition.loader.strategy.scan"/>
            </call>
        </service>
        <service id="graviton_generator.definition.loader.strategy.file" class="%graviton_generator.definition.loader.strategy.file.class%"/>
        <service id="graviton_generator.definition.loader.strategy.dir" class="%graviton_generator.definition.loader.strategy.dir.class%"/>
        <service id="graviton_generator.definition.loader.strategy.scan" class="%graviton_generator.definition.loader.strategy.scan.class%">
            <call method="setScanDir">
                <argument>%kernel.root_dir%/..</argument>
            </call>
        </service>

        <!-- commands -->

        <!-- clean dynamic bundle command -->
        <service id="graviton_generator.command.cleandynamicbundle.kernel" alias="kernel"/>
        <service id="graviton_generator.command.cleandynamicbundle.filesystem"
                 class="Symfony\Component\Filesystem\Filesystem">
        </service>

        <service id="graviton_generator.command.cleandynamicbundle"
                 class="Graviton\GeneratorBundle\Command\CleanDynamicBundleCacheCommand">
            <call method="setKernel">
                <argument type="service" id="graviton_generator.command.cleandynamicbundle.kernel"/>
            </call>
            <call method="setFilesystem">
                <argument type="service" id="graviton_generator.command.cleandynamicbundle.filesystem"/>
            </call>
            <tag name="console.command" />
        </service>

        <service id="graviton_generator.command.generatedynamicbundle.container" alias="service_container"/>
        <service id="graviton_generator.command.generatedynamicbundle.process"
                 class="Symfony\Component\Process\Process">
            <argument type="string" key="null" />
        </service>

        <service id="graviton_generator.command.generatedynamicbundle"
                 class="Graviton\GeneratorBundle\Command\GenerateDynamicBundleCommand">
            <argument type="service" id="graviton_generator.command.generatedynamicbundle.container"/>
            <argument type="service" id="graviton_generator.command.generatedynamicbundle.process"/>
            <tag name="console.command" />
        </service>

    </services>
</container>
