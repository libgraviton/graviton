parameters:
  graviton.rabbitmq.document.eventworker.class: GravitonDyn\EventWorkerBundle\Document\EventWorker
  graviton.rabbitmq.document.eventstatus.class: GravitonDyn\EventStatusBundle\Document\EventStatus
  graviton.rabbitmq.document.eventstatusstatus.class: GravitonDyn\EventStatusBundle\Document\EventStatusStatusEmbedded
  graviton.rabbitmq.document.eventstatuseventresource.class: GravitonDyn\EventStatusBundle\Document\EventStatusEventResourceEmbedded
  graviton.rabbitmq.validator.validinformationtype.class: Graviton\RabbitMqBundle\Validator\Constraints\ValidInformationTypeValidator
  graviton.rabbitmq.validator.validstatus.class: Graviton\RabbitMqBundle\Validator\Constraints\ValidStatusValidator
  graviton.rabbitmq.producer.extamqp.class: Graviton\RabbitMqBundle\Producer\ExtAmqp

services:

    Graviton\RabbitMqBundle\Controller\StatusUpdateController:
      arguments:
        - '@?gravitondyn.eventstatus.model.eventstatus'
        - '@Graviton\RestBundle\Service\RestUtils'
      tags:
        - name: controller.service_arguments

    graviton.rabbitmq.producer.extamqp:
      class: "%graviton.rabbitmq.producer.extamqp.class%"
      public: true
      arguments:
        - '%graviton.rabbitmq.host%'
        - '%graviton.rabbitmq.port%'
        - '%graviton.rabbitmq.user%'
        - '%graviton.rabbitmq.password%'
        - '%graviton.rabbitmq.vhost%'
      calls:
        -
          method: setLogger
          arguments:
            - "@logger"

    # the event 'graviton.rest.response.selfaware' will be dispatched by the SelfLinkResponseListener -->
    Graviton\RabbitMqBundle\Listener\EventStatusLinkResponseListener:
        tags:
          - name: kernel.event_subscriber
        arguments:
          - "@logger"
          - "@graviton.rabbitmq.producer.extamqp"
          - "@router"
          - "@doctrine_mongodb.odm.default_document_manager"
          - "@event_dispatcher"
          - '@Graviton\DocumentBundle\Service\ExtReferenceConverter'
          - "%graviton.rabbitmq.document.eventworker.class%"
          - "%graviton.rabbitmq.document.eventstatus.class%"
          - "%graviton.rabbitmq.document.eventstatusstatus.class%"
          - "%graviton.rabbitmq.document.eventstatuseventresource.class%"
          - 'EventStatus.get'
          - "@graviton.security.service.utils"
          - "%graviton.worker.relativeUrl%"
          - "%graviton.rabbitmq.queueevent.transient_headers%"
